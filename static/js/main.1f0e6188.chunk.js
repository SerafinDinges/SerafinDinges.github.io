(this["webpackJsonpsometa.xyz"]=this["webpackJsonpsometa.xyz"]||[]).push([[0],{220:function(e,t,a){},221:function(e,t,a){},223:function(e,t,a){},224:function(e,t,a){},225:function(e,t,a){},428:function(e,t){},430:function(e,t){},466:function(e,t,a){},467:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(19),s=a.n(o),i=(a(220),a(24)),c=a(25),l=a(39),h=a(38),u=(a(221),a(4)),d=function(e){Object(l.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return Object(u.jsxs)("header",{children:[Object(u.jsx)("h1",{children:"someta.xyz"}),Object(u.jsx)("p",{children:"A tool to investigate data relating but not exclusive to Covid-19."}),Object(u.jsx)("p",{children:Object(u.jsxs)("i",{children:["by ",Object(u.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"http://serafin.tv",children:"Serafin Dinges"})]})})]})}}]),a}(r.a.Component),p=(a(223),function(e){Object(l.a)(a,e);var t=Object(h.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return Object(u.jsxs)("footer",{children:[Object(u.jsx)("hr",{}),Object(u.jsx)("strong",{children:"Data sources:"}),Object(u.jsxs)("p",{children:["Biggest data source is ",Object(u.jsx)("a",{rel:"noopener noreferrer",href:"https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv",target:"_blank",children:"this raw csv sheet"})," compiled by ",Object(u.jsx)("i",{children:"Our World in Data"}),". See full documentation in ",Object(u.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/owid/covid-19-data/tree/master/public/data",children:"their repo"}),". They in turn get their data from the ",Object(u.jsx)("a",{rel:"noopener noreferrer",target:"_blank",href:"https://www.ecdc.europa.eu/en/publications-data/download-todays-data-geographic-distribution-covid-19-cases-worldwide",children:Object(u.jsx)("i",{children:"European Centre for Disease Prevention and Control"})}),"."]}),Object(u.jsxs)("p",{children:["Comparison data is aggregate from a variety of sources. You can have a look at the raw data in my manually transpiled, public ",Object(u.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://docs.google.com/spreadsheets/d/1sAXPISlxdaxPIUAkua6Dxdd5DeWlUQ3fzx6Q9aGzfxY/edit?usp=sharing",children:"Google Sheets document"}),". Specific sources are provided in the sheet notes."]}),Object(u.jsx)("p",{children:"Additional data"}),Object(u.jsx)("ul",{children:Object(u.jsxs)("li",{children:[Object(u.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/weeklyprovisionalfiguresondeathsregisteredinenglandandwales",children:"UK respiratory deaths"})," from the ",Object(u.jsx)("i",{children:"Office for National Statistics"})]})}),Object(u.jsxs)("p",{children:["Peek at the source code: ",Object(u.jsx)("a",{href:"https://github.com/SerafinDinges/someta.xyz",children:"https://github.com/SerafinDinges/someta.xyz"})]})]})}}]),a}(r.a.Component)),f=(a(224),a(225),{countries:{GBR:"UK",DEU:"Germany",AUT:"Austria",USA:"USA",JPN:"Japan",ITA:"Italy",KOR:"South Korea",SWE:"Sweden"},dataSets:{new_deaths:"New deaths*",new_cases:"New cases*",total_deaths:"Total deaths",total_cases:"Total cases"},comparisons:{GBR_new_respiratory_deaths:"Weekly new respiratory deaths\u2020 in England and Wales (five year average)",GBR_new_overall_deaths:"Weekly new overall deaths in England and Wales (five year average)"}});function b(e){var t=e.substring(0,3),a=e.substring(4),n="";a.includes("_per_million")&&(a=a.replace("_per_million",""),n=" (per million)");var r=!1;return r=f.comparisons[e]?f.comparisons[e]:f.dataSets[a],"".concat(f.countries[t]," - ").concat(r).concat(n)}var j=a(31),v=function(e){Object(l.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).colors=[["#998AD3","#E494D3","#CDF1AF","#87DCC0","#88BBE4"],["#9E0C3C","#B01135","#CD1B2D","#E82322","#FB291B"],["#B478FF","#826DE8","#8592FF","#6D9AE8","#78CCFF"],["#5FFF63","#4AE87A","#7EE84A","#52FFB7","#C7FF52"],["#FF4DF2","#E83A85","#BF3AE8","#9E40FF","#7440FF"],["#FF8E59","#E89751","#FFC265","#E8BB51","#FFDE59"],["#FFEA56","#E8C443","#E8E543","#FFC54A","#CAFF4A"],["#E0BBE4","#957DAD","#D291BC","#FEC8D8","#FFDFD3"],["#DEDE65","#9BE386","#5FE0B6","#5AD4DE","#95C1ED","#D2A7DC","#F591B2","#F8897F"]],n.state={colorKey:{countries:{GBR:1,USA:2,DEU:3,AUT:4,ITA:5,JPN:6,KOR:7},dataSets:{}}},n}return Object(c.a)(a,[{key:"getColor",value:function(e){var t=this.state.colorKey.countries[e.substring(0,3)],a=this.state.colorKey.dataSets[e.substring(3)];return this.colors[t]&&this.colors[t][a]?this.colors[t][a]:this.colors[0][Math.floor(5*Math.random())]}},{key:"getAreaColor",value:function(e){return console.log(this.state.colorKey,e),this.colors[8][this.state.colorKey.comparisons[e]]}},{key:"getToolTip",value:function(e,t){return[parseInt(e).toFixed(0),b(t)]}},{key:"buildGraph",value:function(){var e=this;if("LineChart"===this.props.type)return Object(u.jsxs)(j.c,{data:this.props.dataWrapper.data,children:[Object(u.jsx)(j.b,{strokeDasharray:"5 5",stroke:"#eee"}),Object(u.jsx)(j.h,{dataKey:this.props.dataWrapper.labels.xAxis}),Object(u.jsx)(j.i,{type:"number",domain:[0,"auto"]}),Object(u.jsx)(j.g,{formatter:this.getToolTip}),Object(u.jsx)(j.d,{formatter:b}),this.props.dataWrapper.labels.comparisons?this.props.dataWrapper.labels.comparisons.map((function(t){return Object(u.jsx)(j.a,{type:"monotone",dataKey:t,fill:e.getAreaColor(t),stroke:e.getAreaColor(t)},t)})):"",this.props.dataWrapper.labels.dataKeys.map((function(t){return Object(u.jsx)(j.e,{type:"monotone",dataKey:t,stroke:e.getColor(t)},t)}))]})}},{key:"render",value:function(){return Object(u.jsx)("div",{className:"Graph",children:Object(u.jsx)("div",{className:"container",children:Object(u.jsx)(j.f,{aspect:1.9,children:this.buildGraph()})})})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a={},n=0;e.dataWrapper.labels.dataKeys.forEach((function(e){a[e.substring(3)]||(a[e.substring(3)]=n,n++)}));var r={};return e.dataWrapper.labels.comparisons&&(n=0,e.dataWrapper.labels.comparisons.forEach((function(e){r[e]||(r[e]=n,n++)}))),{colorKey:{countries:t.colorKey.countries,dataSets:a,comparisons:r}}}}]),a}(r.a.Component),m=a(30),g=a.n(m),y=a(61),O=a(190),x=a.n(O),_=a(422),w=function(){function e(){Object(i.a)(this,e),this.tabletop=void 0,this.worldData=void 0,this.tabletop=x.a.init({key:"1sAXPISlxdaxPIUAkua6Dxdd5DeWlUQ3fzx6Q9aGzfxY",simpleSheet:!1}),this.worldData=!1}return Object(c.a)(e,[{key:"getSheet",value:function(){var e=Object(y.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.tabletop.then((function(e,a){return e[t].elements})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCVD19CasesByCountry",value:function(){var e=Object(y.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.worldData||(this.worldData=fetch("https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv").then((function(e){return e.text()}))),e.abrupt("return",this.worldData.then((function(e){return _().fromString(e).then((function(e){var a={};e.forEach((function(e){if(t.includes(e.iso_code)){var n=new Date(e.date),r="".concat(n.getFullYear(),"-").concat(n.getMonth()+1,"-").concat(n.getDate());a[r]||(a[r]={date:r,dateObject:n}),a[r].weekday=n.getDay(),a[r][e.iso_code+"_total_cases"]=e.total_cases/1,a[r][e.iso_code+"_total_deaths"]=e.total_deaths/1,a[r][e.iso_code+"_new_deaths"]=e.new_deaths/1,a[r][e.iso_code+"_new_cases"]=e.new_cases/1,a[r][e.iso_code+"_total_cases_per_million"]=parseFloat(e.total_cases_per_million),a[r][e.iso_code+"_new_cases_per_million"]=parseFloat(e.new_cases_per_million),a[r][e.iso_code+"_total_deaths_per_million"]=parseFloat(e.total_deaths_per_million),a[r][e.iso_code+"_new_deaths_per_million"]=parseFloat(e.new_deaths_per_million),a[r].prettyDate="".concat(n.getMonth()+1,"-").concat(n.getDate())}}));var n=[];return Object.keys(a).forEach((function(e){n.push(a[e])})),n}))})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),D=a(454),C=function(){function e(){Object(i.a)(this,e),this.API=void 0,this.API=new w}return Object(c.a)(e,[{key:"getCasesByCountryAndDataset",value:function(){var e=Object(y.a)(g.a.mark((function e(t,a){var n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.API.getCVD19CasesByCountry(t);case 2:return n=e.sent,r={},n=n.sort((function(e,t){var a=new Date(e.date),n=new Date(t.date);return a.getTime()-n.getTime()})),r.data=n,r.labels={xAxis:"prettyDate"},r.labels.dataKeys=[],a.forEach((function(e){t.forEach((function(t){r.labels.dataKeys.push(t+"_"+e)}))})),r.labels.dataKeys.sort(),r.labels.comparisons=[],e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"addObjects",value:function(e,t){return Object.keys(e).forEach((function(a){a.includes("new")&&(e[a]=parseInt(e[a])+parseInt(t[a]))})),e}},{key:"getAverage",value:function(e,t){for(var a=this,n=[],r=function(r){for(var o=!1,s=0,i=r-t;i<=r;)e[i]&&(s++,o=o?a.addObjects(o,e[i]):Object.assign({},e[i])),i++;var c=e[r];Object.keys(c).forEach((function(e){e.includes("new")&&(c[e]=parseInt(o[e])/s)})),n.push(c)},o=0;o<e.length;o++)r(o);return n}},{key:"reduceDataSetToInterval",value:function(e,t,a){console.log("transform to weekly",e.slice());for(var n=0;n<e.length;n++)if(D(e[n].dateObject).dayOfYear()===t-a+1){console.log(D(e[n].dateObject).dayOfYear(),t,a),e.splice(0,n);break}for(var r=[];e.length;)r.push(e.splice(0,a));var o=[];return r.forEach((function(e){o.push(e.reduce((function(e,t){return Object.keys(e).forEach((function(a){a.includes("new")&&(t[a]+=parseInt(e[a]))})),t})))})),console.log("fin",o),o}},{key:"getComparisonData",value:function(){var e=Object(y.a)(g.a.mark((function e(t,a){var n,r,o,s,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.API.getSheet("main_data");case 2:return n=e.sent,console.log(t,a,n),r=[],o=D(n[0].date).dayOfYear(),s=D(n[1].date).dayOfYear()-o,i=this.reduceDataSetToInterval(a.data,o,s),n.forEach((function(e){var a=D(e.date),n=-1;i.forEach((function(e,t){D(e.dateObject).dayOfYear()!==a.dayOfYear()||(n=t)})),n>-1&&(t.forEach((function(t){i[n][t]=e[t]})),r.push(i[n]))})),console.log("FINAL COMPARED",r),a.data=r,a.labels.comparisons=t,e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),k=a(191),E=a(192),F=Object(E.a)();function A(e){console.log(e);var t,a=[];Object.keys(e.options).forEach((function(n){a.push({value:n,label:e.options[n]}),n===e.value&&(t={value:n,label:e.options[n]})}));return Object(u.jsx)(k.a,{closeMenuOnSelect:!1,components:F,isMulti:!0,defaultValue:t,options:a,onChange:function(t){var a=[];t&&t.length>0&&t.forEach((function(e){a.push(e.value)})),e.onChange(a,e.stateKey)}})}var S=function(e){Object(l.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).DataProvider=void 0,n.state={sheetData:[],customData:{data:[],labels:{dataKeys:[]}},compareCountries:["GBR"],showDataSets:["new_deaths"],showComparisons:[],perMillion:!1},n.DataProvider=new C,n.processState(),n}return Object(c.a)(a,[{key:"processState",value:function(){var e=this;if(this.state.showDataSets.length>0&&this.state.compareCountries.length>0){var t=this.state.showDataSets.slice();console.log("dataSets",t.slice()),this.state.perMillion&&t.forEach((function(e,a){t[a]+="_per_million"})),console.log("dataSets",t),this.DataProvider.getCasesByCountryAndDataset(this.state.compareCountries.slice(),t).then((function(t){console.log("before comparison",t,t.data.slice()),e.state.showComparisons.length>0?e.DataProvider.getComparisonData(e.state.showComparisons,t).then((function(t){e.setState({customData:t})})):(t.data=e.DataProvider.getAverage(t.data,2),e.setState({customData:t}))}))}}},{key:"handleChange",value:function(e,t){var a=this;console.log(e,t);var n={};n[t]=e,this.setState(n,(function(){return a.processState()}))}},{key:"render",value:function(){var e=this;return Object(u.jsxs)("div",{className:"Main",children:[Object(u.jsxs)("div",{className:"text",children:[Object(u.jsx)("p",{children:"Compare different countries with each other."}),Object(u.jsx)("h3",{children:"Choose countries"}),Object(u.jsx)(A,{options:f.countries,stateKey:"compareCountries",value:this.state.compareCountries[0],onChange:this.handleChange.bind(this)}),Object(u.jsxs)("h3",{children:["Choose data ",Object(u.jsxs)("label",{htmlFor:"checkbox_per_million",children:[Object(u.jsx)("input",{type:"checkbox",id:"checkbox_per_million",onChange:function(t){e.handleChange.bind(e)(t.target.checked,"perMillion")}}),"per million"]})]}),Object(u.jsx)(A,{options:f.dataSets,stateKey:"showDataSets",value:this.state.showDataSets[0],onChange:this.handleChange.bind(this)}),Object(u.jsx)("p",{className:"footnote",children:"*uses a three day rolling average to better represent the overall trend"}),Object(u.jsx)("h3",{children:"Compare to other data"}),Object(u.jsx)(A,{options:f.comparisons,stateKey:"showComparisons",onChange:this.handleChange.bind(this)}),Object(u.jsxs)("p",{className:"footnote",children:["\u2020refers to all types of respiratory deaths, see ",Object(u.jsx)("a",{href:"https://en.wikipedia.org/wiki/ICD-10_Chapter_X:_Diseases_of_the_respiratory_system",children:"ICD-10 J00-J99"})]})]}),Object(u.jsx)(v,{dataWrapper:this.state.customData,type:"LineChart"})]})}}]),a}(r.a.Component);a(466);var B=function(){return Object(u.jsxs)("div",{className:"App",children:[Object(u.jsx)(d,{}),Object(u.jsx)(S,{}),Object(u.jsx)(p,{})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(Object(u.jsx)(B,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[467,1,2]]]);
//# sourceMappingURL=main.1f0e6188.chunk.js.map